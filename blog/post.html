<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando artículo... | Pestoff Chile</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="../assets/logo-pestoff1.png" type="image/png">

    <script src="https://cdn.jsdelivr.net/npm/contentful@latest/dist/contentful.browser.min.js"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; }
        .post-content h2, .post-content h3 { font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.75rem; line-height: 1.3; }
        .post-content h2 { font-size: 1.5rem; } /* h2 -> ### */
        .post-content h3 { font-size: 1.25rem; } /* h3 -> ### */
        .post-content p { margin-bottom: 1.25rem; line-height: 1.75; }
        .post-content ul, .post-content ol { margin-left: 1.5rem; margin-bottom: 1.25rem; }
        .post-content ul { list-style-type: disc; }
        .post-content ol { list-style-type: decimal; }
        .post-content li { margin-bottom: 0.5rem; }
        .post-content a { color: #00a99d; text-decoration: underline; }
        .post-content blockquote { border-left: 4px solid #a3e2e0; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; }
        .bg-pestoff-teal { background-color: #00a99d; }
        .text-pestoff-dark { color: #2c3e50; }
        .hover\:bg-pestoff-teal-dark:hover { background-color: #008a7e; }
        .bg-pestoff-footer { background-color: #153545; }
    </style>
</head>
<body class="bg-white">

    <header class="bg-white shadow-md sticky top-0 z-50"></header>

    <main class="py-12 md:py-16">
        <div class="container mx-auto px-6 max-w-4xl">
            <h1 id="post-title" class="text-3xl md:text-5xl font-bold text-pestoff-dark mb-4">Cargando...</h1>
            <p id="post-date" class="text-gray-500 mb-8"></p>
            <img id="post-image" src="" alt="" class="w-full h-auto rounded-lg shadow-lg mb-8 hidden">
            <div id="post-content" class="text-gray-800 post-content"></div>
        </div>
    </main>
    
    <footer class="bg-pestoff-footer text-white"></footer>

    <script>
        window.addEventListener('load', () => {
            const SPACE_ID = 'xmg0akvdqvvq';
            const ACCESS_TOKEN = 'VZXkHrnxbb9KFtN9yGYUj0OvBlRecdoZJO-MSkjeN-k';
            const client = window.contentful.createClient({ space: SPACE_ID, accessToken: ACCESS_TOKEN });

            // --- Selectores del DOM ---
            const postTitle = document.getElementById('post-title');
            const postDate = document.getElementById('post-date');
            const postImage = document.getElementById('post-image');
            const postContent = document.getElementById('post-content');

            // ✅ *** RENDERIZADOR DE RICH TEXT AVANZADO ***
            function renderRichText(richTextDocument) {
                if (!richTextDocument || !richTextDocument.content) return '';
                return richTextDocument.content.map(renderNode).join('');
            }

            function renderNode(node) {
                const renderContent = () => node.content ? node.content.map(renderNode).join('') : '';

                switch (node.nodeType) {
                    case 'document': return renderContent();
                    case 'heading-2': return `<h2>${renderContent()}</h2>`;
                    case 'heading-3': return `<h3>${renderContent()}</h3>`;
                    case 'paragraph': return `<p>${renderContent() || '&nbsp;'}</p>`;
                    case 'unordered-list': return `<ul>${renderContent()}</ul>`;
                    case 'ordered-list': return `<ol>${renderContent()}</ol>`;
                    case 'list-item': return `<li>${renderContent()}</li>`;
                    case 'blockquote': return `<blockquote>${renderContent()}</blockquote>`;
                    case 'hr': return '<hr class="my-8">';
                    case 'hyperlink': return `<a href="${node.data.uri}" target="_blank" rel="noopener noreferrer">${renderContent()}</a>`;
                    
                    case 'text':
                        let text = node.value.replace(/\n/g, '<br/>');
                        if (node.marks && node.marks.length > 0) {
                            node.marks.forEach(mark => {
                                if (mark.type === 'bold') text = `<strong>${text}</strong>`;
                                if (mark.type === 'italic') text = `<em>${text}</em>`;
                                if (mark.type === 'underline') text = `<u>${text}</u>`;
                                if (mark.type === 'code') text = `<code>${text}</code>`;
                            });
                        }
                        return text;
                        
                    default: return '';
                }
            }
            
            async function fetchAndDisplayPost() {
                const slug = new URLSearchParams(window.location.search).get('slug');
                if (!slug) { /* ... */ return; }
                try {
                    const response = await client